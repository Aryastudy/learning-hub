<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç®€å¬å†™ä¸“å®¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-line { background-color: #eef2ff; border-left: 4px solid #4f46e5; transform: translateX(5px); }
        .blur-text { filter: blur(5px); transition: all 0.3s; cursor: help; }
        .blur-text:hover { filter: blur(0); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 flex flex-col items-center">
    <div class="max-w-3xl w-full bg-white shadow-2xl rounded-3xl p-6 mt-4">
        <h1 class="text-xl font-bold text-center mb-6 text-indigo-600">ğŸ§ ä¸“ä¸šå¬å†™ç»ƒä¹ åœº</h1>

        <div class="sticky top-0 bg-white z-10 pb-4 border-b">
            <audio id="player" class="w-full mb-4" controls src="audio.mp3"></audio>
            
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="prevStep()" class="px-4 py-2 bg-slate-200 rounded-lg">â® ä¸Šä¸€å¥</button>
                <button onclick="replayCurrent()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold">ğŸ” é‡å¬æœ¬å¥</button>
                <button onclick="nextStep()" class="px-4 py-2 bg-slate-200 rounded-lg">ä¸‹ä¸€å¥ â­</button>
                <label class="flex items-center ml-4">
                    <input type="checkbox" id="autoRepeat" checked class="w-5 h-5">
                    <span class="ml-2">å•å¥å¾ªç¯</span>
                </label>
            </div>
        </div>

        <div id="displayArea" class="mt-6 space-y-4">
            </div>

        <details class="mt-10 border-t pt-4">
            <summary class="text-xs text-gray-400 cursor-pointer text-center">ç‚¹å‡»æ›´æ–°é…ç½®æ•°æ® (æ— éœ€ä¿®æ”¹ GitHub ä»£ç )</summary>
            <textarea id="jsonInput" class="w-full h-32 mt-2 p-2 text-xs border rounded" placeholder="åœ¨æ­¤ç²˜è´´ AI Studio çš„ JSON æ•°æ®..."></textarea>
            <button onclick="updateData()" class="w-full mt-2 bg-black text-white py-1 text-sm rounded">æ›´æ–°é¡µé¢å†…å®¹</button>
        </details>
    </div>

    <script>
        // åˆå§‹åŒ–æ•°æ®
        let data = []; 
        let currentIndex = 0;
        const player = document.getElementById('player');
        const displayArea = document.getElementById('displayArea');
        const buffer = 0.25; // è¡¥å¿å€¼ï¼Œè§£å†³æœ€åå•è¯æ²¡è¯»å®Œçš„é—®é¢˜

        function render() {
            displayArea.innerHTML = '';
            data.forEach((item, index) => {
                const div = document.createElement('div');
                div.id = `line-${index}`;
                div.className = "p-4 rounded-xl border transition-all duration-200 mb-2 cursor-pointer relative group";
                div.innerHTML = `
                    <div class="blur-text text-lg text-gray-800" id="text-${index}">${item.text}</div>
                    <div class="text-xs text-gray-400 mt-1 uppercase font-mono">Segment ${index + 1}</div>
                `;
                div.onclick = () => jumpTo(index);
                displayArea.appendChild(div);
            });
        }

        function jumpTo(index) {
            currentIndex = index;
            player.currentTime = data[index].start;
            player.play();
            updateHighlight();
        }

        function replayCurrent() {
            jumpTo(currentIndex);
        }

        function nextStep() {
            if (currentIndex < data.length - 1) jumpTo(currentIndex + 1);
        }

        function prevStep() {
            if (currentIndex > 0) jumpTo(currentIndex - 1);
        }

        function updateHighlight() {
            document.querySelectorAll('#displayArea > div').forEach(el => el.classList.remove('active-line'));
            const active = document.getElementById(`line-${currentIndex}`);
            if (active) {
                active.classList.add('active-line');
                active.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        player.addEventListener('timeupdate', () => {
            const currentItem = data[currentIndex];
            if (!currentItem) return;

            // å¦‚æœå¼€å¯äº†å•å¥å¾ªç¯ï¼Œä¸”åˆ°è¾¾ç»“æŸæ—¶é—´ï¼ˆåŠ äº†è¡¥å¿ï¼‰
            if (document.getElementById('autoRepeat').checked) {
                if (player.currentTime >= (currentItem.end + buffer)) {
                    player.currentTime = currentItem.start;
                }
            }
        });

        // æœ¬åœ°æ›´æ–° JSON æ•°æ®çš„åŠŸèƒ½
        function updateData() {
            const raw = document.getElementById('jsonInput').value;
            try {
                // è‡ªåŠ¨æ¸…ç† AI Studio å¯èƒ½ä¼šå¸¦æœ‰çš„ const data = å‰ç¼€
                const cleanJson = raw.replace(/const data = /, '').replace(/;$/, '');
                data = JSON.parse(cleanJson);
                render();
                alert('æ•°æ®æ›´æ–°æˆåŠŸï¼');
            } catch (e) {
                alert('JSON æ ¼å¼æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥ï¼');
            }
        }

        // åˆå§‹åŠ è½½ä¹‹å‰çš„æ•°æ®
        data = [
          { "text": "The English oak is one of Britain's most iconic trees.", "start": 5.0, "end": 8.5 },
          { "text": "Broad and majestic, this tree supports more species than any other native tree in the UK.", "start": 9.0, "end": 17.8 }
          // ... æ›´å¤šæ•°æ®
        ];
        render();
    </script>
</body>
</html>
